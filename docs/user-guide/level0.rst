.. _level0:

************
Level 0 Data
************

Overview
========
This section document the format of the level 0 binary files.
Level 0 binary files contain raw packets generated by the instrument.
All packets make use of the `CCSDS packet format protocol <https://public.ccsds.org/default.aspx>`_. 
A CCSDS packet is made of three parts: a required primary header, an optional secondary header, and a User data section. 
The packet data consists of all parts that are not the required primary header inclusive of the optional secondary header.
There are four types of packets:
#. Photon packets
#. Histogram (or spectrum) packets
#. Housekeeping packets
#. Command response packets
A single binary file will contain a mixture of these four kinds of packets.
The packet formats for each are defined below.
All packets make use of 16 bit words.
This python packet makes use of `CCSDSPy <https://github.com/ccsdspy/ccsdspy/>`_ to parse these packets.

Photon Packet
-------------
This packet provides provides individual hit data or photons for each detector.
These packets are downlinked on demand and are therefore not always available.

+------------------+------------+------+-----------------------------------------------------------------------------------+
| Name             | Bit length | Type | Description                                                                       |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 1   | 16         | UINT | Identifies the packet and CCSDS version (always 0x00A1)                           |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 2   | 16         | UINT | Identifies the packet number (0xB11 and sequence count)                           |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 3   | 16         | UINT | Payload length (The length in 8 bit units of the remainder of the packet minus 1) |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Timestamp        | 48         | UINT |                                                                                   |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Integration time | 16         | UINT | The integration time in 12.8 us per count                                         |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Flags            | 16         | UINT | Various flags (TBD)                                                               |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Checksum         | 16         | UINT | XOR checksum of the entire packet                                                 |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Pixel Data       | variable   |      | This field is repeated based on the number of hits detected                       |
+------------------+------------+------+-----------------------------------------------------------------------------------+

The pixel data portion of the packet repeats the following for each hit.

+------------+------------+------+------------------------------------------------------------------------------+
| Name       | Bit Length | Type | Description                                                                  |
+------------+------------+------+------------------------------------------------------------------------------+
| Time step  | 16         | UINT | The time of the hit as an offset from the packet time.                       |
+------------+------------+------+------------------------------------------------------------------------------+
| Pixel ID   | 16         | UINT | The pixel identifier which includes the detector number and the pixel number |
+------------+------------+------+------------------------------------------------------------------------------+
| Pixel data | 16         | UINT | The pixel data which is related to the photon energy.                        |
+------------+------------+------+------------------------------------------------------------------------------+

Histogram Packet
----------------
This packet provides per pixel histograms or spectra on a regular basis.
These packets are always available and are used for science but also as a summary product to understand when to request photon packets from the spacecraft.

+----------------+------------+------+-----------------------------------------------------------------------------------+
| Name           | Bit Length | Type | Description                                                                       |
+----------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 1 | 16         | UINT | Identifies the packet and CCSDS version (always 0x00A0)                           |
+----------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 2 | 16         | UINT | Identifies the packet number (0xB11 and sequence count)                           |
+----------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 3 | 16         | UINT | Payload length (The length in 8 bit units of the remainder of the packet minus 1) |
+----------------+------------+------+-----------------------------------------------------------------------------------+
| Start time     | 48         | UINT |                                                                                   |
+----------------+------------+------+-----------------------------------------------------------------------------------+
| End time       | 48         | UINT |                                                                                   |
+----------------+------------+------+-----------------------------------------------------------------------------------+
| Histogram data |            |      | This field is repeated for every pixel and for every detector or 48 times         |
+----------------+------------+------+-----------------------------------------------------------------------------------+

The following defines the histogram data portion of the packet.
+-----------------+------------+------+---------------------------------------+
| Name            | Bit Length | Type | Description                           |
+-----------------+------------+------+---------------------------------------+
| Histogram sync  | 8          | UINT | 0xCA                                  |
+-----------------+------------+------+---------------------------------------+
| Detector Number | 3          | UINT | The detector identifier               |
+-----------------+------------+------+---------------------------------------+
| Pixel Number    | 5          | UINT | Pixel identifier                      |
+-----------------+------------+------+---------------------------------------+
| Count Data      | 8192       | UINT | 16 bit count values in 512 bins.      |
+-----------------+------------+------+---------------------------------------+

Housekeeping Packet
-------------------
This packet provides housekeeping information about the state of health of the instrument.
These packets are always available.

+------------------+------------+------+-----------------------------------------------------------------------------------+
| Name             | Bit length | Type | Description                                                                       |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 1   | 16         | UINT | Identifies the packet and CCSDS version (always 0x00A3)                           |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 2   | 16         | UINT | Identifies the packet number (0xB11 and sequence count)                           |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 3   | 16         | UINT | Payload length (The length in 8 bit units of the remainder of the packet minus 1) |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Timestamp        | 48         | UINT |                                                                                   |
+------------------+------------+------+-----------------------------------------------------------------------------------+


Command Response Packet
-----------------------
This packet is a response to a command.

+------------------+------------+------+-----------------------------------------------------------------------------------+
| Name             | Bit length | Type | Description                                                                       |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 1   | 16         | UINT | Identifies the packet and CCSDS version (always 0x00A5)                           |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 2   | 16         | UINT | Identifies the packet number (0xB11 and sequence count)                           |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| CCSDS Header 3   | 16         | UINT | Payload length (The length in 8 bit units of the remainder of the packet minus 1) |
+------------------+------------+------+-----------------------------------------------------------------------------------+
| Timestamp        | 48         | UINT |                                                                                   |
+------------------+------------+------+-----------------------------------------------------------------------------------+
